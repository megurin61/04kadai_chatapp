<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»è¨³æ©Ÿèƒ½ä»˜ããƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .remove:hover {
            background: #7fffd4;
        }
    </style>
    <!-- jQueryã®èª­ã¿è¾¼ã¿ -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>

    <h1 id="title">ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</h1>
    <!-- è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ -->
    <button id="btn-ja">æ—¥æœ¬èª</button>
    <button id="btn-en">English</button>

    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
    <div>
        <div>
            <input type="text" id="uname" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
        </div>
        <div>
            <textarea id="text" placeholder="æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
        </div>
        <button id="send">é€ä¿¡</button>
        <div id="output"></div>
    </div>

    <script type="module">
        // Firebaseã®è¨­å®šã¨åˆæœŸåŒ–
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, push, set, remove, onChildAdded, onChildRemoved } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "API_KEY_HERE",
            authDomain: "chat-3975e.firebaseapp.com",
            databaseURL: "https://chat-3975e-default-rtdb.firebaseio.com",
            projectId: "chat-3975e",
            storageBucket: "chat-3975e.appspot.com",
            messagingSenderId: "51955708754",
            appId: "1:51955708754:web:9d1a75d6428ddf74ba408b",
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, "chat");

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ™‚
        $("#send").on("click", function () {
            const msg = {
                uname: $("#uname").val(),
                text: $("#text").val()
            };
            const newPostRef = push(dbRef);
            set(newPostRef, msg);
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿½åŠ ã•ã‚ŒãŸã¨ã
        onChildAdded(dbRef, function (data) {
            const msg = data.val();
            const key = data.key;
            let h = `<p id="${key}">${msg.uname}<br>`;
            h += `<span contentEditable="true" id="${key}_update">${msg.text}</span>`;
            h += `<span class="remove" data-key="${key}">ğŸš®</span></p>`;
            $("#output").prepend(h);
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤æ™‚
        $("#output").on("click", ".remove", function () {
            const key = $(this).attr("data-key");
            const removeItem = ref(db, "chat/" + key);
            remove(removeItem);
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‰Šé™¤ã•ã‚ŒãŸã¨ã
        onChildRemoved(dbRef, function (data) {
            $("#" + data.key).remove();
        });

        // ç¿»è¨³ãƒ‡ãƒ¼ã‚¿
        const translations = {
            en: {
                title: "Chat App",
                namePlaceholder: "Enter your name",
                textPlaceholder: "Enter your message",
                sendButton: "Send"
            },
            ja: {
                title: "ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª",
                namePlaceholder: "åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
                textPlaceholder: "æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
                sendButton: "é€ä¿¡"
            }
        };

        // è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        function translateTo(lang) {
            // ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´
            $("#title").text(translations[lang].title);
            // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’å¤‰æ›´
            $("#uname").attr("placeholder", translations[lang].namePlaceholder);
            $("#text").attr("placeholder", translations[lang].textPlaceholder);
            // ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å¤‰æ›´
            $("#send").text(translations[lang].sendButton);
        }

        // æ—¥æœ¬èªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        $("#btn-ja").on("click", function() {
            translateTo("ja");
        });

        // è‹±èªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        $("#btn-en").on("click", function() {
            translateTo("en");
        });
    </script>
</body>
</html>
